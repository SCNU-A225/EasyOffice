<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>个人中心</title>
        <meta name="keywords" content="HTML5 Bootstrap 3 Admin Template UI Theme" />
        <meta name="description" content="AbsoluteAdmin - A Responsive HTML5 Admin UI Framework">
        <meta name="author" content="AbsoluteAdmin">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="css/theme.css">
        <link rel="stylesheet" type="text/css" href="css/admin-forms.css">
        <link rel="shortcut icon" href="img/favicon.ico">
    </head>
    <body class="admin-validation-page" data-spy="scroll" data-target="#nav-spy" data-offset="200">
        <div id="main">
            <header class="navbar navbar-fixed-top navbar-shadow">
                <div class="navbar-branding">
                    <a class="navbar-brand" href="#">
                        <b>EasyOffice</b>OA
                    </a>
                    <span id="toggle_sidemenu_l" class="ad ad-lines"></span>
                </div>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown menu-merge">
                        <a href="#" class="dropdown-toggle fw600 p15" data-toggle="dropdown">
                            <img src="./img/avatars/5.jpg" alt="avatar" class="mw30 br64">
                            <span id="rname" class="hidden-xs pl15">  </span>
                            <span class="caret caret-tp hidden-xs"></span>
                        </a>
                        <ul class="dropdown-menu list-group dropdown-persist w250" role="menu">
                            <li class="list-group-item">
                                <a href="./self.html" class="animated animated-short fadeInUp">
                                    <span class="fa fa-user"></span> 个人信息
                                    <span class="label label-warning"></span>
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a href="./change_password.html" id="setPaswd" class="animated animated-short fadeInUp">
                                    <span class="fa fa-gear"></span> 设置密码 </a>
                            </li>
                            <li class="dropdown-footer">
                                <a href="#" onclick="quit()" class="">
                                    <span class="fa fa-power-off pr5"></span> 退出 </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </header>
            <aside id="sidebar_left" class="nano nano-light affix">
                <div class="sidebar-left-content nano-content">
                    <header class="sidebar-header">
                        <div class="sidebar-widget author-widget">
                            <div class="media">
                                <a class="media-left" href="#">
                                    <img src="./img/avatars/5.jpg" class="img-responsive">
                                </a>
                                <div class="media-body">
                                    <div class="media-author">
                                        <span id="lname"></span>
                                        --
                                        <span id="post1"></span>
                                    </div>
                                    <div class="media-links">
                                        <a  href="#" onclick="quit()">退出</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sidebar-widget search-widget hidden">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-search"></i>
                                </span>
                                <input type="text" id="sidebar-search" class="form-control" placeholder="Search...">
                            </div>
                        </div>
                    </header>
                    <ul class="nav sidebar-menu">
                        <li class="sidebar-label pt20">日常管理</li>
                        <li>
                            <a href="./claim_voucher_deal.html">
                                <span class="glyphicon glyphicon-book"></span>
                                <span class="sidebar-title">待处理报销单</span>
                                <span class="sidebar-title-tray">
                                    <span class="label label-xs bg-primary">New</span>
                                </span>
                            </a>
                        </li>
                        <li class="active">
                            <a href="./claim_voucher_self.html">
                                <span class="glyphicon glyphicon-home"></span>
                                <span class="sidebar-title">个人报销单</span>
                            </a>
                        </li>
                        <li>
                            <a href="./claim_voucher_add.html">
                                <span class="fa fa-calendar"></span>
                                <span class="sidebar-title">填写报销单</span>
                            </a>
                        </li>
                        <li class="sidebar-label pt15">基础信息管理</li>
                        <li>
                            <a class="accordion-toggle" href="#">
                                <span class="glyphicon glyphicon-check"></span>
                                <span class="sidebar-title">员工管理</span>
                                <span class="caret"></span>
                            </a>
                            <ul class="nav sub-nav">
                                <li>
                                    <a href="#" id="allEmployee">
                                        <span class="glyphicon glyphicon-calendar"></span> 所有员工 </a>
                                </li>
                                <li class="active">
                                    <a href="#" id="addEmployee">
                                        <span class="glyphicon glyphicon-check"></span> 添加员工 </a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a class="accordion-toggle" href="#">
                                <span class="fa fa-columns"></span>
                                <span class="sidebar-title">部门管理</span>
                                <span class="caret"></span>
                            </a>
                            <ul class="nav sub-nav">
                                <li>
                                    <a href="#" id="allDepartment">
                                        <span class="glyphicon glyphicon-calendar"></span> 所有部门 </a>
                                </li>
                                <li class="active">
                                    <a href="#" id="addDepartment">
                                        <span class="glyphicon glyphicon-check"></span> 添加部门 </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <div class="sidebar-toggle-mini">
                        <a href="#">
                            <span class="fa fa-sign-out"></span>
                        </a>
                    </div>
                </div>
            </aside>
            <section id="content_wrapper">

                <section id="content" class="table-layout animated fadeIn">
                    <div class="tray tray-center">
                        <div class="content-header">
                            <h2> 添加部门 </h2>
                            <p class="lead"></p>
                        </div>
                        <div class="admin-form theme-primary mw1000 center-block" style="padding-bottom: 175px;">
                            <div class="panel heading-border">
                                <form:form action="/department/add" modelAttribute="department"  id="admin-form" name="addForm">
                                    <div class="panel-body bg-light">
                                        <div class="section-divider mt20 mb40">
                                            <span> 基本信息 </span>
                                        </div>
                                        <div class="section row">
                                            <div class="col-md-6">
                                                <label for="sn" class="field prepend-icon">
                                                    <form:input path="sn" cssClass="gui-input" placeholder="编号..."/>
                                                    <label for="sn" class="field-icon">
                                                        <i class="fa fa-user"></i>
                                                    </label>
                                                </label>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="name" class="field prepend-icon">
                                                    <form:input path="name" cssClass="gui-input" placeholder="名称..." />
                                                    <label for="name" class="field-icon">
                                                        <i class="fa fa-user"></i>
                                                    </label>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="section">
                                            <label for="address" class="field prepend-icon">
                                                <form:input path="address" cssClass="gui-input" placeholder="地址..." />
                                                <label for="address" class="field-icon">
                                                    <i class="fa fa-lock"></i>
                                                </label>
                                            </label>
                                        </div>
                                        <div class="panel-footer text-right">
                                            <button type="submit" class="button"> 保存 </button>
                                            <button type="button" class="button" onclick="javascript:window.history.go(-1);"> 返回 </button>
                                        </div>
                                    </div>
                                </form:form>
                            </div>
                        </div>
                    </div>
                </section>
            </section>
        </div>
    <style>
        /* demo page styles */
        body { min-height: 2300px; }

        .content-header b,
        .admin-form .panel.heading-border:before,
        .admin-form .panel .heading-border:before {
            transition: all 0.7s ease;
        }
        /* responsive demo styles */
        @media (max-width: 800px) {
            .admin-form .panel-body { padding: 18px 12px; }
        }
    </style>

    <style>
        .ui-datepicker select.ui-datepicker-month,
        .ui-datepicker select.ui-datepicker-year {
            width: 48%;
            margin-top: 0;
            margin-bottom: 0;

            line-height: 25px;
            text-indent: 3px;

            color: #888;
            border-color: #DDD;
            background-color: #FDFDFD;

            -webkit-appearance: none; /*Optionally disable dropdown arrow*/
        }
    </style>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
    <script src="js/jquery-ui-datepicker.min.js"></script>
    <script src="js/utility.js"></script>
    <script src="js/demo.js"></script>
    <script src="js/main.js"></script>
    <script type="text/javascript" src="js/pages.js"></script>
    <script type="text/javascript" src="js/items.js"></script>
    <script>
        //页面加载时获取个人信息
        $(document).ready(function(){
            var sn = getQueryVariable("sn")
            $.ajax({
                method:'POST',
                url:'http://127.0.0.1:5050/user/info',
                data:`sn=${sn}`,
                success:function(data,msg,xhr){
                    $('#rname').html(data.name)
                    $('#lname').html(data.name)
                    $('#post1').html(data.post)
                },
                error:function(xhr,err){
                    console.log('异步请求失败'),
                    console.log(xhr)
                    console.log(err)
                }
            })
        })

        function getQueryVariable(variable)
        {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }
        
        //注销session,退出登录
        function quit()
        {
            $.ajax({
                method:'GET',
                url:'http://127.0.0.1:5050/logout',
                data:``,
                success:function(data,msg,xhr){
                    //跳转到登录页
                    window.location.href = "login.html"
                },
                error:function(xhr,err){
                    console.log('异步请求失败'),
                    console.log(xhr)
                    console.log(err)
                }
            })
        }

        //判断 部门管理 员工管理 的用户权限
        $('#allEmployee').click(function (){
            let post = $('#post1').html()
            if(post == '部门经理' || post == '总经理'){
                window.location.href = "employee_list.html"
            }
            else{
                $('#modelMsgTitle').html("无法访问")
                $('#modelMsgBody').html("您的权限不够")
                $('#modelMsg').modal()
            }
        })
        $('#addEmployee').click(function (){
            let post = $('#post1').html()
            if(post == '部门经理' || post == '总经理'){
                window.location.href = "employee_add.html"
            }
            else{
                $('#modelMsgTitle').html("无法访问")
                $('#modelMsgBody').html("您的权限不够")
                $('#modelMsg').modal()
            }
        })
        $('#allDepartment').click(function (){
            let post = $('#post1').html()
            if(post == '部门经理' || post == '总经理'){
                window.location.href = "department_list.html"
            }
            else{
                $('#modelMsgTitle').html("无法访问")
                $('#modelMsgBody').html("您的权限不够")
                $('#modelMsg').modal()
            }
        })
        $('#addDepartment').click(function (){
            let post = $('#post1').html()
            if(post == '部门经理' || post == '总经理'){
                window.location.href = "department_add.html"
            }
            else{
                $('#modelMsgTitle').html("无法访问")
                $('#modelMsgBody').html("您的权限不够")
                $('#modelMsg').modal()
            }
        })

        $('#changePaswd').click(function (){

            let old = $('#old').val()
            let new1 = $('#new1').val()
            let new2 = $('#new2').val()

            if(old == '' || new1 == '' || new2 == ''){
                $('#modelMsgTitle').html("修改失败")
                $('#modelMsgBody').html("密码框不能为空")
                $('#modelMsg').modal()
            }
            else{
                $.ajax({
                    method:'POST',
                    url:'http://127.0.0.1:5050/logout',
                    data:`password=${new1}`,
                    success:function(data,msg,xhr){
                        if(data.code == 200){
                            $('#modelMsgTitle').html("修改成功")
                            $('#modelMsgBody').html("新密码已设置")
                            $('#modelMsg').modal()
                        }
                        else{
                            $('#modelMsgTitle').html("修改失败")
                            $('#modelMsgBody').html("原密码错误")
                            $('#modelMsg').modal()
                        }
                    },
                    error:function(xhr,err){
                        console.log('异步请求失败'),
                        console.log(xhr)
                        console.log(err)
                    }
                })
            }
        })
    </script>
    <!--弹框表示修改结果-->
    <div id="modelMsg" class="modal fade"><!--半透明遮罩-->
        <div class="modal-dialog modal-sm"><!--对话框的尺寸，位置-->
            <div class="modal-content"><!--边框，倒角，背景色-->
                <!--头部-->
                <div class="modal-header">
                    <h4 class="modal-title" id="modelMsgTitle"></h4>
                </div>
                <!--主体-->
                <div class="modal-body">
                    <p>
                        <span id="modelMsgBody"></span>
                    </p>
                </div>
                <!--尾部-->
                <div class="modal-footer">
                    <button type="button" data-dismiss="modal" class="btn btn-info">确定</button>
            </div>
        </div>
    </div>
</body>

</html>