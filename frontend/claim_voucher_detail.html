<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>个人中心</title>
    <meta name="keywords" content="HTML5 Bootstrap 3 Admin Template UI Theme" />
    <meta name="description" content="AbsoluteAdmin - A Responsive HTML5 Admin UI Framework">
    <meta name="author" content="AbsoluteAdmin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/theme.css">
    <link rel="stylesheet" type="text/css" href="css/admin-forms.css">
    <link rel="shortcut icon" href="img/favicon.ico">
</head>

<body class="admin-validation-page" data-spy="scroll" data-target="#nav-spy" data-offset="200">
    <div id="main">
        <header class="navbar navbar-fixed-top navbar-shadow">
            <div class="navbar-branding">
                <a class="navbar-brand" href="#">
                    <b>EasyOffice</b>OA
                </a>
                <span id="toggle_sidemenu_l" class="ad ad-lines"></span>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown menu-merge">
                    <a href="#" class="dropdown-toggle fw600 p15" data-toggle="dropdown">
                        <img src="./img/avatars/5.jpg" alt="avatar" class="mw30 br64">
                        <span id="rname" class="hidden-xs pl15"> </span>
                        <span class="caret caret-tp hidden-xs"></span>
                    </a>
                    <ul class="dropdown-menu list-group dropdown-persist w250" role="menu">
                        <li class="list-group-item">
                            <a href="./self.html" class="animated animated-short fadeInUp">
                                <span class="fa fa-user"></span> 个人信息
                                <span class="label label-warning"></span>
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="./change_password.html" id="setPaswd" class="animated animated-short fadeInUp">
                                <span class="fa fa-gear"></span> 设置密码 </a>
                        </li>
                        <li class="dropdown-footer">
                            <a href="#" onclick="quit()" class="">
                                <span class="fa fa-power-off pr5"></span> 退出 </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </header>
        <aside id="sidebar_left" class="nano nano-light affix">
            <div class="sidebar-left-content nano-content">
                <header class="sidebar-header">
                    <div class="sidebar-widget author-widget">
                        <div class="media">
                            <a class="media-left" href="#">
                                <img src="./img/avatars/5.jpg" class="img-responsive">
                            </a>
                            <div class="media-body">
                                <div class="media-author">
                                    <span id="lname"></span>
                                    --
                                    <span id="post1"></span>
                                </div>
                                <div class="media-links">
                                    <a href="#" onclick="quit()">退出</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sidebar-widget search-widget hidden">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <i class="fa fa-search"></i>
                            </span>
                            <input type="text" id="sidebar-search" class="form-control" placeholder="Search...">
                        </div>
                    </div>
                </header>
                <ul class="nav sidebar-menu">
                    <li class="sidebar-label pt20">日常管理</li>
                    <li>
                        <a href="./claim_voucher_deal.html">
                            <span class="glyphicon glyphicon-book"></span>
                            <span class="sidebar-title">待处理报销单</span>
                            <span class="sidebar-title-tray">
                                <span class="label label-xs bg-primary">New</span>
                            </span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="./claim_voucher_self.html">
                            <span class="glyphicon glyphicon-home"></span>
                            <span class="sidebar-title">个人报销单</span>
                        </a>
                    </li>
                    <li>
                        <a href="./claim_voucher_add.html">
                            <span class="fa fa-calendar"></span>
                            <span class="sidebar-title">填写报销单</span>
                        </a>
                    </li>
                    <li id="infoManagmentLabel" class="sidebar-label pt15">基础信息管理</li>
                    <li id="employeeManagement">
                        <a class="accordion-toggle" href="#">
                            <span class="glyphicon glyphicon-check"></span>
                            <span class="sidebar-title hid">员工管理</span>
                            <span class="caret"></span>
                        </a>
                        <ul class="nav sub-nav">
                            <li>
                                <a href="#" id="allEmployee">
                                    <span class="glyphicon glyphicon-calendar"></span> 所有员工 </a>
                            </li>
                            <li class="active">
                                <a href="#" id="addEmployee">
                                    <span class="glyphicon glyphicon-check"></span> 添加员工 </a>
                            </li>
                        </ul>
                    </li>
                    <li id="departmentManagement">
                        <a class="accordion-toggle" href="#">
                            <span class="fa fa-columns"></span>
                            <span class="sidebar-title">部门管理</span>
                            <span class="caret"></span>
                        </a>
                        <ul class="nav sub-nav">
                            <li>
                                <a href="#" id="allDepartment">
                                    <span class="glyphicon glyphicon-calendar"></span> 所有部门 </a>
                            </li>
                            <li class="active">
                                <a href="#" id="addDepartment">
                                    <span class="glyphicon glyphicon-check"></span> 添加部门 </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div class="sidebar-toggle-mini">
                    <a href="#">
                        <span class="fa fa-sign-out"></span>
                    </a>
                </div>
            </div>
        </aside>
        <section id="content" class="table-layout animated fadeIn">
            <div class="tray tray-center">
                <div class="content-header">
                    <h2> 报销单详情 </h2>
                    <p class="lead"></p>
                </div>
                <div class="admin-form theme-primary mw1000 center-block" style="padding-bottom: 175px;">
                    <div class="panel heading-border">
                        <div class="panel-body bg-light" id="info">
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
    <script src="js/jquery-ui-datepicker.min.js"></script>
    <script src="js/utility.js"></script>
    <script src="js/demo.js"></script>
    <script src="js/main.js"></script>
    <script type="text/javascript" src="js/pages.js"></script>
    <script src="js/base.js"></script>
    <script src="js/nav-base.js"></script>

    <script>
    $(window).ready(() => {
        let id = getQueryVariable("id")
        $.ajax({
            method:'POST',
            url:'http://127.0.0.1:5050/expense/detail',
            data:`id=${id}`,
            xhrFields:{withCredentials:true},
            success:function(data,msg,xhr){
                let cteate_time = new Date(data.info.create_time).Format("yyyy-MM-dd hh:mm:ss")
                let html = `
                            <div class="section-divider mt30 mb20">
                                <span> 基本信息 </span>
                            </div>
                            <div class="section row">
                                <div class="col-md-2"><b>事由</b></div>
                                <div class="col-md-6">${data.info.cause}</div>
                            </div>
                            <div class="section row">
                                <div class="col-md-2"><b>创建人</b></div>
                                <div class="col-md-4">${data.info.create_sn}</div>
                                <div class="col-md-2"><b>创建时间</b></div>
                                <div class="col-md-4">${cteate_time}</div>
                            </div>
                            <div class="section row">
                                <div class="col-md-2"><b>待处理人</b></div>
                                <div class="col-md-4">${data.info.next_deal_sn}</div>
                                <div class="col-md-2"><b>状态</b></div>
                                <div class="col-md-4">${data.info.status}</div>
                            </div>
                            <div class="section-divider mt40 mb20">
                                <span> 费用明细 </span>
                            </div>
                            <table class="table">
                                <tr>
                                    <th>类型</th>
                                    <th>金额</th>
                                    <th>备注</th>
                                </tr>`
                for(let each of data.detail){
                    html += `<tr>
                                <td>${each.item}</td>
                                <td>${each.amount}</td>
                                <td>${each.comment}</td>
                            </tr>`
                }
                html +=     `<tr>
                                <td><b>总金额: ${data.info.total_amount}</b></td>
                            </tr>
                                </tbody>
                            </table>
                            <div class="section-divider mt30 mb20">
                                <span> 处理流程 </span>
                            </div>
                            <table class="table mb30">
                                <tr>
                                    <th>处理人</th>
                                    <th>处理时间</th>
                                    <th>处理类型</th>
                                    <th>处理结果</th>
                                    <th>备注</th>
                                </tr>
                            `
                for(let each of data.record){
                    let deal_time = new Date(each.deal_time).Format("yyyy-MM-dd hh:mm:ss")
                    html += `<tr>
                                <td>${each.deal_sn}</td>
                                <td>${deal_time}</td>
                                <td>${each.deal_way}</td>
                                <td>${each.deal_result}</td>
                                <td>${each.comment}</td>
                            </tr>`
                }
                html +=     `   </tbody>
                            </table>
                            <div class="panel-footer text-right">
                                <button type="button" class="button btn-primary" onclick="javascript:window.history.go(-1);"> 返回
                                </button>
                            </div>`
                $('#info').html(html)
            },
            error:function(xhr,err){
                alert('异步请求失败')
                console.log(xhr)
                console.log(err)
            }
        })
    })
    </script>


    <div id="modelMsg" class="modal fade">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="modelMsgTitle"></h4>
                </div>
                <div class="modal-body">
                    <p><span id="modelMsgBody"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" data-dismiss="modal" class="btn btn-info">确定</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>